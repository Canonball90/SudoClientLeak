package sudo.module.exploit;
import net.minecraft.entity.Entity;
import net.minecraft.util.math.Vec3d;
import sudo.module.Mod;
import sudo.module.settings.BooleanSetting;
import sudo.module.settings.ModeSetting;
import sudo.module.settings.NumberSetting;

public class EntityFly extends Mod {
    private Entity boat = null;
    
    public ModeSetting mode = new ModeSetting("Mode", "Bypass", "Bypass", "Static");
    public NumberSetting factor = new NumberSetting("Factor", 0, 5, 0.5, 0.1);
    public BooleanSetting rotate = new BooleanSetting("Rotate", false);
    
    public EntityFly() {
        super("EntityFly", "Allows you to fly when riding an entity", Category.EXPLOIT, 0);
        addSettings(mode,factor,rotate);
    }
    
    @Override
    public void onTick() {
		if (mc.player != null && mc.player.hasVehicle()) {
	    	if(mode.is("Bypass")) {
    			final Entity vehicle = mc.player.getVehicle();
    			final Vec3d velocity = vehicle.getVelocity();
    			final double motionY = mc.options.jumpKey.isPressed() ? 0.5 : 0.0;
    			vehicle.setVelocity(new Vec3d(velocity.x, motionY, velocity.z));
	    	}
	    	
	    	if(mode.is("Static")) {
		    	boat = mc.player.getVehicle();
		        if (boat != null) {
		            Vec3d np = boat.getPos();
		            float y = mc.player.getYaw();
		            int mx = 0, my = 0, mz = 0;
		            if (mc.options.jumpKey.isPressed())
		                my++;
		            if (mc.options.backKey.isPressed())
		                mz++;
		            if (mc.options.leftKey.isPressed())
		                mx--;
		            if (mc.options.rightKey.isPressed())
		                mx++;
		            if (mc.options.forwardKey.isPressed())
		                mz--;
		            double ts = 1;
		            double s = Math.sin(Math.toRadians(y));
		            double c = Math.cos(Math.toRadians(y));
		            double nx = ts * mz * s;
		            double nz = ts * mz * -c;
		            double ny = ts * my;
		            nx += ts * mx * -c;
		            nz += ts * mx * -s;
		            Vec3d nv3 = new Vec3d(nx, ny, nz);
		            np = np.add(nv3.multiply(factor.getValue() / 10));
		            boat.updatePosition(np.x, np.y, np.z);
		            boat.setVelocity(0, 0, 0);
		            nv3 = nv3.multiply(0.1);
		            boat.addVelocity(nv3.x, nv3.y, nv3.z);
		        }
		        if(rotate.isEnabled()) {
		        	boat.setYaw(mc.player.getYaw());
		        }
			}
		}
        super.onTick();
    }
    
    @Override
    public void onDisable() {
        if (boat != null) {
            boat.setNoGravity(false);
        }
    }
}

